<!DOCTYPE html><html lang="zh-tw,en,default"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> build your own images · ChihKang's Blog</title><meta name="description" content="build your own images - ChihKang Lin"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives" target="_self" class="nav-list-link">ARCHIVES</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">build your own images</h1><div class="post-info">2016年8月18日</div><div class="post-content"><h3 id="Docker-Getting-Started"><a href="#Docker-Getting-Started" class="headerlink" title="Docker-Getting-Started"></a>Docker-Getting-Started</h3><p>Docker images are the basis of containers. Each time you&#x2019;ve used <code>docker run</code> you told it which image you wanted.</p>
<p>In the previous sections of the guide you used <code>Docker images</code> that already exist, for example the <code>ubuntu</code> image and the <code>training/webapp</code> image.</p>
<p>You also discovered that Docker stores downloaded images on the Docker host.</p>
<p>If an image isn&#x2019;t already present on the host then it&#x2019;ll be downloaded from a registry:</p>
<p>by default the <a href="https://hub.docker.com/" target="_blank" rel="external">Docker Hub Registry</a>.</p>
<p>In this section you&#x2019;re going to explore Docker images a bit more including:</p>
<ul>
<li>Managing and working with images locally on your Docker host.</li>
<li>Creating basic images.</li>
<li>Uploading images to <a href="https://hub.docker.com/" target="_blank" rel="external">Docker Hub Registry</a>.</li>
</ul>
<h3 id="Listing-images-on-the-host"><a href="#Listing-images-on-the-host" class="headerlink" title="Listing images on the host"></a>Listing images on the host</h3><p>Let&#x2019;s start with listing the images you have locally on our host. You can do this using the <code>docker images</code> command like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt; docker images</div><div class="line">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">centos                      latest              970633036444        6 days ago          196.7 MB</div><div class="line">ubuntu                      14.04               0ccb13bf1954        2 weeks ago         188 MB</div><div class="line">hello-world                 latest              c54a2cc56cbb        4 weeks ago         1.848 kB</div><div class="line">busybox                     latest              2b8fd9751c4c        6 weeks ago         1.093 MB</div><div class="line">nginx                       latest              0d409d33b27e        9 weeks ago         182.8 MB</div><div class="line">training/webapp             latest              6fae60ef3446        14 months ago       348.8 MB</div><div class="line">dockerinaction/ch2_mailer   latest              d4bd30aedcdc        15 months ago       2.454 MB</div><div class="line">dockerinaction/ch2_agent    latest              dcd74f00ef30        15 months ago       2.454 MB</div></pre></td></tr></table></figure>
<p>You can see the images you&#x2019;ve previously used in the user guide. Each has been downloaded from <a href="https://hub.docker.com/" target="_blank" rel="external">Docker Hub</a> </p>
<p>when you launched a container using that image. When you list images, you get three crucial pieces of information in the listing.</p>
<ul>
<li>What repository they came from, for example <code>ubuntu</code>.</li>
<li>The tags for each image, for example <code>14.04</code>.</li>
<li>The image ID of each image.</li>
</ul>
<blockquote>
<p>Tip: You can use a <a href="https://github.com/justone/dockviz" target="_blank" rel="external">third-party dockviz tool</a> or the <a href="https://imagelayers.io/" target="_blank" rel="external">Image layers site</a> to display<br>visualizations of image data.</p>
</blockquote>
<p>A repository potentially holds multiple variants of an image. In the case of our <code>ubuntu</code> image you can see multiple variants covering Ubuntu 10.04, 12.04, 12.10, 13.04, 13.10 and 14.04. Each variant is identified by a tag and you can refer to a tagged image like so:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ubuntu:14.04</div></pre></td></tr></table></figure>
<p>So when you run a container you refer to a tagged image like so:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker run -t -i ubuntu:14.04 /bin/bash</div></pre></td></tr></table></figure></p>
<p>If instead you wanted to run an Ubuntu 12.04 image you&#x2019;d use:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker run -t -i ubuntu:12.04 /bin/bash</div></pre></td></tr></table></figure></p>
<p>If you don&#x2019;t specify a variant, for example you just use ubuntu, then Docker will default to using the <code>ubuntu:latest</code> image.</p>
<blockquote>
<p>Tip: You should always specify an image tag, for example ubuntu:14.04.<br>That way, you always know exactly what variant of an image you are using. This is useful for troubleshooting and debugging.</p>
</blockquote>
<h3 id="Getting-a-new-image"><a href="#Getting-a-new-image" class="headerlink" title="Getting a new image"></a>Getting a new image</h3><p>So how do you get new images? Well Docker will automatically download any image you use that isn&#x2019;t already present on the Docker host. </p>
<p>But this can potentially add some time to the launch of a container. </p>
<p>If you want to pre-load an image you can download it using the <code>docker pull</code> command. Suppose you&#x2019;d like to download the centos image.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt; docker pull centos</div><div class="line">Using default tag: latest</div><div class="line">latest: Pulling from library/centos</div><div class="line"></div><div class="line">3d8673bd162a: Pull complete</div><div class="line">Digest: sha256:a66ffcb73930584413de83311ca11a4cb4938c9b2521d331026dad970c19adf4</div><div class="line">Status: Downloaded newer image for centos:latest</div></pre></td></tr></table></figure>
<p>You can see that each layer of the image has been pulled down and now you can run a container from this image and you won&#x2019;t have to wait to download the image.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt; docker run -t -i centos /bin/bash</div><div class="line">[root@2773165cd268 /]#</div></pre></td></tr></table></figure>
<h3 id="Finding-images"><a href="#Finding-images" class="headerlink" title="Finding images"></a>Finding images</h3><p>You can also search for images on the command line using the <code>docker search</code> command. Suppose your team wants an image with Ruby and Sinatra installed on which to do our web application development. You can search for a suitable image by using the <code>docker search</code> command to find all the images that contain the term <code>sinatra</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt; docker search sinatra</div><div class="line">NAME                                         DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</div><div class="line">erikap/ruby-sinatra                          Docker for hosting Sinatra apps                 10                   [OK]</div><div class="line">semtech/mu-sinatra-template                  Template for running Ruby/Sinatra microser...   2                    [OK]</div><div class="line">zyio/sinatra                                 Tiny-ish Sinatra Dockerfile                     1                    [OK]</div><div class="line">lucymhdavies/sinatra-boilerplate             Docker image with my boilerplate for Sinat...   1                    [OK]</div><div class="line">samlet/microservices-sinatra-products        microservices with sinatra                      1                    [OK]</div><div class="line">tdiary/rpaproxy-sinatra                                                                      1                    [OK]</div><div class="line">shaoheshan/sinatra                                                                           0                    [OK]</div><div class="line">zhenkyle/sinatra                             Build my own automated build `sinatra` exa...   0                    [OK]</div><div class="line">mdzhang/docker-sinatra-hello-world           (WIP) Hello World web app using Docker, Si...   0                    [OK]</div><div class="line">tashoyan/sinatra                             sinatra                                         0                    [OK]</div><div class="line">khwada/sinatra                               sinatra for hands on of aws-docker-fluentd-s3   0                    [OK]</div><div class="line">gwjjeff/sinatra                                                                              0                    [OK]</div><div class="line">thoom/sinatra-mock                           Used to build a Sinatra-backed mock web se...   0                    [OK]</div><div class="line">gk727/sinatra                                this is my sinatra                              0                    [OK]</div><div class="line">jeremypruitt/docker-sinatra                  Alpine 3 with ruby, rspec, and sinatra          0                    [OK]</div><div class="line">mdzhang/vagrant-docker-sinatra-hello-world   Hello World web app using Vagrant, Docker ...   0                    [OK]</div><div class="line">torico/sinatra-async                         port 3001. for AWS                              0                    [OK]</div><div class="line">kerona/sinatra                                                                               0                    [OK]</div><div class="line">zoomix/sinatra-galleria                                                                      0                    [OK]</div><div class="line">welldoer/sinatra                             Sinatra webapp                                  0                    [OK]</div><div class="line">larmar/sinatra-puppet                                                                        0                    [OK]</div><div class="line">shangaijun/sinatra                                                                           0                    [OK]</div><div class="line">synctree/sinatra-echo                                                                        0                    [OK]</div><div class="line">sashaegorov/docker-alpine-sinatra            Alpine Sinatra is project for running a Si...   0                    [OK]</div><div class="line">windurst/sinatra                                                                             0                    [OK]</div></pre></td></tr></table></figure>
<h3 id="Pulling-our-image"><a href="#Pulling-our-image" class="headerlink" title="Pulling our image"></a>Pulling our image</h3><p>You&#x2019;ve identified a suitable image, <code>training/sinatra</code>, and now you can download it using the <code>docker pull</code> command.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker pull training/sinatra</div></pre></td></tr></table></figure>
<p>The team can now use this image by running their own containers.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt; docker run -t -i training/sinatra /bin/bash</div><div class="line">root@763dbb6cde59:/#</div></pre></td></tr></table></figure>
<h3 id="Creating-our-own-images"><a href="#Creating-our-own-images" class="headerlink" title="Creating our own images"></a>Creating our own images</h3><p>The team has found the <code>training/sinatra</code> image pretty useful but it&#x2019;s not quite what they need and you need to make some changes to it. There are two ways you can update and create images.</p>
<ol>
<li>You can update a container created from an image and commit the results to an image.</li>
<li>You can use a <code>Dockerfile</code> to specify instructions to create an image.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt; docker run -t -i training/sinatra /bin/bash</div><div class="line">root@763dbb6cde59:/#</div></pre></td></tr></table></figure>
<blockquote>
<p>Note: Take note of the container ID that has been created, <strong>763dbb6cde59</strong>, as you&#x2019;ll need it in a moment.</p>
</blockquote>
<p>Inside our running container first let&#x2019;s update Ruby:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root@763dbb6cde59:/# apt-get install -y ruby2.0-dev</div></pre></td></tr></table></figure>
<p>Now let&#x2019;s add the <code>json</code> gem.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">root@763dbb6cde59:/# rvm use 2.3.0 --default</div><div class="line">Using /usr/local/rvm/gems/ruby-2.3.0</div><div class="line">root@763dbb6cde59:/# gem install json</div><div class="line">Fetching: json-2.0.2.gem (100%)</div><div class="line">Building native extensions.  This could take a while...</div><div class="line">Successfully installed json-2.0.2</div><div class="line">Parsing documentation for json-2.0.2</div><div class="line">Installing ri documentation for json-2.0.2</div><div class="line">Done installing documentation for json after 1 seconds</div><div class="line">1 gem installed</div></pre></td></tr></table></figure>
<p>Once this has completed let&#x2019;s exit our container using the <code>exit</code> command.</p>
<p>Now you have a container with the change you want to make. You can then commit a copy of this container to an image using the <code>docker commit</code> command.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt; docker commit -m &quot;Added json gem&quot; -a &quot;ChihKang Lin&quot; 763dbb6cde59 chihkang/sinatra:v2</div><div class="line">sha256:7bf415004e58ef1b4ab0f2bc258cf1142b6fcac042cd62ab39e5d48174477756</div></pre></td></tr></table></figure>
<p>Here you&#x2019;ve used the docker commit command. You&#x2019;ve specified two flags: <code>-m</code> and <code>-a</code>. The <code>-m</code> flag allows us to specify a commit message, much like you would with a commit on a version control system. The <code>-a</code> flag allows us to specify an author for our update.</p>
<p>You&#x2019;ve also specified the container you want to create this new image from, <code>763dbb6cde59</code> (the ID you recorded earlier) and you&#x2019;ve specified a target for the image:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chihkang/sinatra:v2</div></pre></td></tr></table></figure>
<p><strong>Break this target down. It consists of a new user, <code>chihkang</code>, that you&#x2019;re writing this image to. You&#x2019;ve also specified the name of the image, here you&#x2019;re keeping the original image name <code>sinatra</code>. Finally you&#x2019;re specifying a tag for the image: <code>v2</code>.</strong></p>
<p>You can then look at our new <code>chihkang/sinatra</code> image using the <code>docker images</code> command.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt; docker images</div><div class="line">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">chihkang/sinatra            v2                  7bf415004e58        3 minutes ago       641.6 MB</div><div class="line">python                      2.7                 1c6554d85da7        6 days ago          675.1 MB</div><div class="line">centos                      latest              970633036444        2 weeks ago         196.7 MB</div><div class="line">ubuntu                      14.04               0ccb13bf1954        3 weeks ago         188 MB</div><div class="line">hello-world                 latest              c54a2cc56cbb        6 weeks ago         1.848 kB</div><div class="line">busybox                     latest              2b8fd9751c4c        7 weeks ago         1.093 MB</div><div class="line">nginx                       latest              0d409d33b27e        10 weeks ago        182.8 MB</div><div class="line">training/webapp             latest              6fae60ef3446        15 months ago       348.8 MB</div><div class="line">dockerinaction/ch2_mailer   latest              d4bd30aedcdc        15 months ago       2.454 MB</div><div class="line">dockerinaction/ch2_agent    latest              dcd74f00ef30        15 months ago       2.454 MB</div><div class="line">training/sinatra            latest              49d952a36c58        2 years ago         447 MB</div></pre></td></tr></table></figure>
<p>To use our new image to create a container you can then:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt; docker run -t -i chihkang/sinatra:v2 /bin/bash</div><div class="line">root@864f7774fb3c:/#</div></pre></td></tr></table></figure>
<h3 id="Building-an-image-from-a-Dockerfile"><a href="#Building-an-image-from-a-Dockerfile" class="headerlink" title="Building an image from a Dockerfile"></a>Building an image from a Dockerfile</h3><p>Using the <code>docker commit</code> command is a pretty simple way of extending an image but it&#x2019;s a bit cumbersome and it&#x2019;s not easy to share a development process for images amongst a team. Instead you can use a new command, <code>docker build</code>, to build new images from scratch.</p>
<p>To do this you create a <code>Dockerfile</code> that contains a set of instructions that tell Docker how to build our image.</p>
<p>First, create a <code>directory</code> and a Dockerfile.</p>
<p>If you are using Docker Machine on Windows, you may access your host directory by <code>cd</code> to <code>/c/Users/your_user_name</code>.</p>
<p>Each instruction creates a new layer of the image. Try a simple example now for building your own Sinatra image for your fictitious development team.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># This is a comment</div><div class="line">FROM ubuntu:14.04</div><div class="line">MAINTAINER ChihKang Lin &lt;chikang@example.com&gt;</div><div class="line">RUN apt-get update &amp;&amp; apt-get install -y ruby ruby-dev</div><div class="line">RUN gem install sinatra</div></pre></td></tr></table></figure>
<p>Examine what your <code>Dockerfile</code> does. Each instruction prefixes a statement and is capitalized.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">INSTRUCTION statement</div></pre></td></tr></table></figure>
<blockquote>
<p>Note : You use # to indicate a comment</p>
</blockquote>
<p>The first instruction <code>FROM</code> tells Docker what the source of our image is, in this case you&#x2019;re basing our new image on an Ubuntu 14.04 image. The instruction uses the <code>MAINTAINER</code> instruction to specify who maintains the new image.</p>
<p>Lastly, you&#x2019;ve specified two <code>RUN</code> instructions. A <code>RUN</code> instruction executes a command inside the image, for example installing a package. Here you&#x2019;re updating our APT cache, installing Ruby and RubyGems and then installing the Sinatra gem.</p>
<p>Now let&#x2019;s take our <code>Dockerfile</code> and use the <code>docker build</code> command to build an image.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div></pre></td><td class="code"><pre><div class="line">$ docker build -t chihkang/sinatra:b1 .</div><div class="line">Sending build context to Docker daemon 2.048 kB</div><div class="line">Step 1 : FROM ubuntu:16.04</div><div class="line">16.04: Pulling from library/ubuntu</div><div class="line">2f0243478e1f: Pulling fs layer</div><div class="line">d8909ae88469: Pulling fs layer</div><div class="line">820f09abed29: Pulling fs layer</div><div class="line">01193a8f3d88: Pulling fs layer</div><div class="line">01193a8f3d88: Waiting</div><div class="line">d8909ae88469: Verifying Checksum</div><div class="line">d8909ae88469: Download complete</div><div class="line">820f09abed29: Verifying Checksum</div><div class="line">820f09abed29: Download complete</div><div class="line">01193a8f3d88: Verifying Checksum</div><div class="line">01193a8f3d88: Download complete</div><div class="line">2f0243478e1f: Verifying Checksum</div><div class="line">2f0243478e1f: Download complete</div><div class="line">2f0243478e1f: Pull complete</div><div class="line">d8909ae88469: Pull complete</div><div class="line">820f09abed29: Pull complete</div><div class="line">01193a8f3d88: Pull complete</div><div class="line">Digest: sha256:8e2324f2288c26e1393b63e680ee7844202391414dbd48497e9a4fd997cd3cbf</div><div class="line">Status: Downloaded newer image for ubuntu:16.04</div><div class="line"> ---&gt; f8d79ba03c00</div><div class="line">Step 2 : MAINTAINER ChihKang Lin &lt;chikang@example.com&gt;</div><div class="line"> ---&gt; Running in 75979b2f7cce</div><div class="line"> ---&gt; 6bf6aa5a0191</div><div class="line">Removing intermediate container 75979b2f7cce</div><div class="line">Step 3 : RUN apt-get update &amp;&amp; apt-get install -y ruby ruby-dev</div><div class="line"> ---&gt; Running in cb34882ac11d</div><div class="line">Get:1 http://archive.ubuntu.com/ubuntu xenial InRelease [247 kB]</div><div class="line">Get:2 http://archive.ubuntu.com/ubuntu xenial-updates InRelease [95.7 kB]</div><div class="line">Get:3 http://archive.ubuntu.com/ubuntu xenial-security InRelease [94.5 kB]</div><div class="line">Get:4 http://archive.ubuntu.com/ubuntu xenial/main Sources [1103 kB]</div><div class="line">Get:5 http://archive.ubuntu.com/ubuntu xenial/restricted Sources [5179 B]</div><div class="line">Get:6 http://archive.ubuntu.com/ubuntu xenial/universe Sources [9802 kB]</div><div class="line">Get:7 http://archive.ubuntu.com/ubuntu xenial/main amd64 Packages [1558 kB]</div><div class="line">Get:8 http://archive.ubuntu.com/ubuntu xenial/restricted amd64 Packages [14.1 kB]</div><div class="line">Get:9 http://archive.ubuntu.com/ubuntu xenial/universe amd64 Packages [9827 kB]</div><div class="line">Get:10 http://archive.ubuntu.com/ubuntu xenial-updates/main Sources [225 kB]</div><div class="line">Get:11 http://archive.ubuntu.com/ubuntu xenial-updates/universe Sources [112 kB]</div><div class="line">Get:12 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 Packages [473 kB]</div><div class="line">Get:13 http://archive.ubuntu.com/ubuntu xenial-updates/universe amd64 Packages [398 kB]</div><div class="line">Get:14 http://archive.ubuntu.com/ubuntu xenial-security/main Sources [42.1 kB]</div><div class="line">Get:15 http://archive.ubuntu.com/ubuntu xenial-security/universe Sources [9622 B]</div><div class="line">Get:16 http://archive.ubuntu.com/ubuntu xenial-security/main amd64 Packages [161 kB]</div><div class="line">Get:17 http://archive.ubuntu.com/ubuntu xenial-security/universe amd64 Packages [46.3 kB]</div><div class="line">Fetched 24.2 MB in 1min 56s (209 kB/s)</div><div class="line">Reading package lists...</div><div class="line">Reading package lists...</div><div class="line">Building dependency tree...</div><div class="line">Reading state information...</div><div class="line">The following additional packages will be installed:</div><div class="line">  ca-certificates fonts-lato javascript-common libffi6 libgdbm3 libgmp-dev</div><div class="line">  libgmp10 libgmpxx4ldbl libjs-jquery libruby2.3 libssl1.0.0 libyaml-0-2</div><div class="line">  openssl rake ruby-did-you-mean ruby-minitest ruby-net-telnet</div><div class="line">  ruby-power-assert ruby-test-unit ruby2.3 ruby2.3-dev rubygems-integration</div><div class="line">  unzip zip</div><div class="line">Suggested packages:</div><div class="line">  apache2 | lighttpd | httpd gmp-doc libgmp10-doc libmpfr-dev ri bundler</div><div class="line">The following NEW packages will be installed:</div><div class="line">  ca-certificates fonts-lato javascript-common libffi6 libgdbm3 libgmp-dev</div><div class="line">  libgmp10 libgmpxx4ldbl libjs-jquery libruby2.3 libssl1.0.0 libyaml-0-2</div><div class="line">  openssl rake ruby ruby-dev ruby-did-you-mean ruby-minitest ruby-net-telnet</div><div class="line">  ruby-power-assert ruby-test-unit ruby2.3 ruby2.3-dev rubygems-integration</div><div class="line">  unzip zip</div><div class="line">0 upgraded, 26 newly installed, 0 to remove and 1 not upgraded.</div><div class="line">Need to get 9846 kB of archives.</div><div class="line">After this operation, 41.0 MB of additional disk space will be used.</div><div class="line">Get:1 http://archive.ubuntu.com/ubuntu xenial/main amd64 libgdbm3 amd64 1.8.3-13.1 [16.9 kB]</div><div class="line">Get:2 http://archive.ubuntu.com/ubuntu xenial/main amd64 fonts-lato all 2.0-1 [2693 kB]</div><div class="line">Get:3 http://archive.ubuntu.com/ubuntu xenial/main amd64 libyaml-0-2 amd64 0.1.6-3 [47.6 kB]</div><div class="line">Get:4 http://archive.ubuntu.com/ubuntu xenial/main amd64 libffi6 amd64 3.2.1-4 [17.8 kB]</div><div class="line">Get:5 http://archive.ubuntu.com/ubuntu xenial/main amd64 libgmp10 amd64 2:6.1.0+dfsg-2 [240 kB]</div><div class="line">Get:6 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libssl1.0.0 amd64 1.0.2g-1ubuntu4.1 [1122 kB]</div><div class="line">Get:7 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 openssl amd64 1.0.2g-1ubuntu4.1 [491 kB]</div><div class="line">Get:8 http://archive.ubuntu.com/ubuntu xenial/main amd64 ca-certificates all 20160104ubuntu1 [191 kB]</div><div class="line">Get:9 http://archive.ubuntu.com/ubuntu xenial/main amd64 javascript-common all 11 [6066 B]</div><div class="line">Get:10 http://archive.ubuntu.com/ubuntu xenial/main amd64 libgmpxx4ldbl amd64 2:6.1.0+dfsg-2 [8948 B]</div><div class="line">Get:11 http://archive.ubuntu.com/ubuntu xenial/main amd64 libgmp-dev amd64 2:6.1.0+dfsg-2 [314 kB]</div><div class="line">Get:12 http://archive.ubuntu.com/ubuntu xenial/main amd64 libjs-jquery all 1.11.3+dfsg-4 [161 kB]</div><div class="line">Get:13 http://archive.ubuntu.com/ubuntu xenial/main amd64 rubygems-integration all 1.10 [4966 B]</div><div class="line">Get:14 http://archive.ubuntu.com/ubuntu xenial/main amd64 ruby-did-you-mean all 1.0.0-2 [8390 B]</div><div class="line">Get:15 http://archive.ubuntu.com/ubuntu xenial/main amd64 ruby-minitest all 5.8.4-2 [36.6 kB]</div><div class="line">Get:16 http://archive.ubuntu.com/ubuntu xenial/main amd64 ruby-net-telnet all 0.1.1-2 [12.6 kB]</div><div class="line">Get:17 http://archive.ubuntu.com/ubuntu xenial/main amd64 ruby-power-assert all 0.2.7-1 [7668 B]</div><div class="line">Get:18 http://archive.ubuntu.com/ubuntu xenial/main amd64 ruby-test-unit all 3.1.7-2 [60.3 kB]</div><div class="line">Get:19 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 libruby2.3 amd64 2.3.1-2~16.04 [2957 kB]</div><div class="line">Get:20 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 ruby2.3 amd64 2.3.1-2~16.04 [40.9 kB]</div><div class="line">Get:21 http://archive.ubuntu.com/ubuntu xenial/main amd64 ruby all 1:2.3.0+1 [5530 B]</div><div class="line">Get:22 http://archive.ubuntu.com/ubuntu xenial/main amd64 rake all 10.5.0-2 [48.2 kB]</div><div class="line">Get:23 http://archive.ubuntu.com/ubuntu xenial-updates/main amd64 ruby2.3-dev amd64 2.3.1-2~16.04 [1034 kB]</div><div class="line">Get:24 http://archive.ubuntu.com/ubuntu xenial/main amd64 ruby-dev amd64 1:2.3.0+1 [4408 B]</div><div class="line">Get:25 http://archive.ubuntu.com/ubuntu xenial/main amd64 unzip amd64 6.0-20ubuntu1 [158 kB]</div><div class="line">Get:26 http://archive.ubuntu.com/ubuntu xenial/main amd64 zip amd64 3.0-11 [158 kB]</div><div class="line">debconf: delaying package configuration, since apt-utils is not installed</div><div class="line">Fetched 9846 kB in 6s (1446 kB/s)</div><div class="line">Selecting previously unselected package libgdbm3:amd64.</div><div class="line">(Reading database ... 7256 files and directories currently installed.)</div><div class="line">Preparing to unpack .../libgdbm3_1.8.3-13.1_amd64.deb ...</div><div class="line">Unpacking libgdbm3:amd64 (1.8.3-13.1) ...</div><div class="line">Selecting previously unselected package fonts-lato.</div><div class="line">Preparing to unpack .../fonts-lato_2.0-1_all.deb ...</div><div class="line">Unpacking fonts-lato (2.0-1) ...</div><div class="line">Selecting previously unselected package libyaml-0-2:amd64.</div><div class="line">Preparing to unpack .../libyaml-0-2_0.1.6-3_amd64.deb ...</div><div class="line">Unpacking libyaml-0-2:amd64 (0.1.6-3) ...</div><div class="line">Selecting previously unselected package libffi6:amd64.</div><div class="line">Preparing to unpack .../libffi6_3.2.1-4_amd64.deb ...</div><div class="line">Unpacking libffi6:amd64 (3.2.1-4) ...</div><div class="line">Selecting previously unselected package libgmp10:amd64.</div><div class="line">Preparing to unpack .../libgmp10_2%3a6.1.0+dfsg-2_amd64.deb ...</div><div class="line">Unpacking libgmp10:amd64 (2:6.1.0+dfsg-2) ...</div><div class="line">Selecting previously unselected package libssl1.0.0:amd64.</div><div class="line">Preparing to unpack .../libssl1.0.0_1.0.2g-1ubuntu4.1_amd64.deb ...</div><div class="line">Unpacking libssl1.0.0:amd64 (1.0.2g-1ubuntu4.1) ...</div><div class="line">Selecting previously unselected package openssl.</div><div class="line">Preparing to unpack .../openssl_1.0.2g-1ubuntu4.1_amd64.deb ...</div><div class="line">Unpacking openssl (1.0.2g-1ubuntu4.1) ...</div><div class="line">Selecting previously unselected package ca-certificates.</div><div class="line">Preparing to unpack .../ca-certificates_20160104ubuntu1_all.deb ...</div><div class="line">Unpacking ca-certificates (20160104ubuntu1) ...</div><div class="line">Selecting previously unselected package javascript-common.</div><div class="line">Preparing to unpack .../javascript-common_11_all.deb ...</div><div class="line">Unpacking javascript-common (11) ...</div><div class="line">Selecting previously unselected package libgmpxx4ldbl:amd64.</div><div class="line">Preparing to unpack .../libgmpxx4ldbl_2%3a6.1.0+dfsg-2_amd64.deb ...</div><div class="line">Unpacking libgmpxx4ldbl:amd64 (2:6.1.0+dfsg-2) ...</div><div class="line">Selecting previously unselected package libgmp-dev:amd64.</div><div class="line">Preparing to unpack .../libgmp-dev_2%3a6.1.0+dfsg-2_amd64.deb ...</div><div class="line">Unpacking libgmp-dev:amd64 (2:6.1.0+dfsg-2) ...</div><div class="line">Selecting previously unselected package libjs-jquery.</div><div class="line">Preparing to unpack .../libjs-jquery_1.11.3+dfsg-4_all.deb ...</div><div class="line">Unpacking libjs-jquery (1.11.3+dfsg-4) ...</div><div class="line">Selecting previously unselected package rubygems-integration.</div><div class="line">Preparing to unpack .../rubygems-integration_1.10_all.deb ...</div><div class="line">Unpacking rubygems-integration (1.10) ...</div><div class="line">Selecting previously unselected package ruby-did-you-mean.</div><div class="line">Preparing to unpack .../ruby-did-you-mean_1.0.0-2_all.deb ...</div><div class="line">Unpacking ruby-did-you-mean (1.0.0-2) ...</div><div class="line">Selecting previously unselected package ruby-minitest.</div><div class="line">Preparing to unpack .../ruby-minitest_5.8.4-2_all.deb ...</div><div class="line">Unpacking ruby-minitest (5.8.4-2) ...</div><div class="line">Selecting previously unselected package ruby-net-telnet.</div><div class="line">Preparing to unpack .../ruby-net-telnet_0.1.1-2_all.deb ...</div><div class="line">Unpacking ruby-net-telnet (0.1.1-2) ...</div><div class="line">Selecting previously unselected package ruby-power-assert.</div><div class="line">Preparing to unpack .../ruby-power-assert_0.2.7-1_all.deb ...</div><div class="line">Unpacking ruby-power-assert (0.2.7-1) ...</div><div class="line">Selecting previously unselected package ruby-test-unit.</div><div class="line">Preparing to unpack .../ruby-test-unit_3.1.7-2_all.deb ...</div><div class="line">Unpacking ruby-test-unit (3.1.7-2) ...</div><div class="line">Selecting previously unselected package libruby2.3:amd64.</div><div class="line">Preparing to unpack .../libruby2.3_2.3.1-2~16.04_amd64.deb ...</div><div class="line">Unpacking libruby2.3:amd64 (2.3.1-2~16.04) ...</div><div class="line">Selecting previously unselected package ruby2.3.</div><div class="line">Preparing to unpack .../ruby2.3_2.3.1-2~16.04_amd64.deb ...</div><div class="line">Unpacking ruby2.3 (2.3.1-2~16.04) ...</div><div class="line">Selecting previously unselected package ruby.</div><div class="line">Preparing to unpack .../ruby_1%3a2.3.0+1_all.deb ...</div><div class="line">Unpacking ruby (1:2.3.0+1) ...</div><div class="line">Selecting previously unselected package rake.</div><div class="line">Preparing to unpack .../archives/rake_10.5.0-2_all.deb ...</div><div class="line">Unpacking rake (10.5.0-2) ...</div><div class="line">Selecting previously unselected package ruby2.3-dev:amd64.</div><div class="line">Preparing to unpack .../ruby2.3-dev_2.3.1-2~16.04_amd64.deb ...</div><div class="line">Unpacking ruby2.3-dev:amd64 (2.3.1-2~16.04) ...</div><div class="line">Selecting previously unselected package ruby-dev:amd64.</div><div class="line">Preparing to unpack .../ruby-dev_1%3a2.3.0+1_amd64.deb ...</div><div class="line">Unpacking ruby-dev:amd64 (1:2.3.0+1) ...</div><div class="line">Selecting previously unselected package unzip.</div><div class="line">Preparing to unpack .../unzip_6.0-20ubuntu1_amd64.deb ...</div><div class="line">Unpacking unzip (6.0-20ubuntu1) ...</div><div class="line">Selecting previously unselected package zip.</div><div class="line">Preparing to unpack .../archives/zip_3.0-11_amd64.deb ...</div><div class="line">Unpacking zip (3.0-11) ...</div><div class="line">Processing triggers for libc-bin (2.23-0ubuntu3) ...</div><div class="line">Setting up libgdbm3:amd64 (1.8.3-13.1) ...</div><div class="line">Setting up fonts-lato (2.0-1) ...</div><div class="line">Setting up libyaml-0-2:amd64 (0.1.6-3) ...</div><div class="line">Setting up libffi6:amd64 (3.2.1-4) ...</div><div class="line">Setting up libgmp10:amd64 (2:6.1.0+dfsg-2) ...</div><div class="line">Setting up libssl1.0.0:amd64 (1.0.2g-1ubuntu4.1) ...</div><div class="line">debconf: unable to initialize frontend: Dialog</div><div class="line">debconf: (TERM is not set, so the dialog frontend is not usable.)</div><div class="line">debconf: falling back to frontend: Readline</div><div class="line">debconf: unable to initialize frontend: Readline</div><div class="line">debconf: (Can&apos;t locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.22.1 /usr/local/share/perl/5.22.1 /usr/lib/x86_64-linux-gnu/perl5/5.22 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.22 /usr/share/perl/5.22 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7.)</div><div class="line">debconf: falling back to frontend: Teletype</div><div class="line">Setting up openssl (1.0.2g-1ubuntu4.1) ...</div><div class="line">Setting up ca-certificates (20160104ubuntu1) ...</div><div class="line">debconf: unable to initialize frontend: Dialog</div><div class="line">debconf: (TERM is not set, so the dialog frontend is not usable.)</div><div class="line">debconf: falling back to frontend: Readline</div><div class="line">debconf: unable to initialize frontend: Readline</div><div class="line">debconf: (Can&apos;t locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.22.1 /usr/local/share/perl/5.22.1 /usr/lib/x86_64-linux-gnu/perl5/5.22 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.22 /usr/share/perl/5.22 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base .) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7.)</div><div class="line">debconf: falling back to frontend: Teletype</div><div class="line">Setting up javascript-common (11) ...</div><div class="line">Setting up libgmpxx4ldbl:amd64 (2:6.1.0+dfsg-2) ...</div><div class="line">Setting up libgmp-dev:amd64 (2:6.1.0+dfsg-2) ...</div><div class="line">Setting up libjs-jquery (1.11.3+dfsg-4) ...</div><div class="line">Setting up rubygems-integration (1.10) ...</div><div class="line">Setting up ruby-did-you-mean (1.0.0-2) ...</div><div class="line">Setting up ruby-minitest (5.8.4-2) ...</div><div class="line">Setting up ruby-net-telnet (0.1.1-2) ...</div><div class="line">Setting up ruby-power-assert (0.2.7-1) ...</div><div class="line">Setting up ruby-test-unit (3.1.7-2) ...</div><div class="line">Setting up unzip (6.0-20ubuntu1) ...</div><div class="line">Setting up zip (3.0-11) ...</div><div class="line">Setting up libruby2.3:amd64 (2.3.1-2~16.04) ...</div><div class="line">Setting up ruby2.3 (2.3.1-2~16.04) ...</div><div class="line">Setting up ruby2.3-dev:amd64 (2.3.1-2~16.04) ...</div><div class="line">Setting up ruby-dev:amd64 (1:2.3.0+1) ...</div><div class="line">Setting up ruby (1:2.3.0+1) ...</div><div class="line">Setting up rake (10.5.0-2) ...</div><div class="line">Processing triggers for libc-bin (2.23-0ubuntu3) ...</div><div class="line">Processing triggers for ca-certificates (20160104ubuntu1) ...</div><div class="line">Updating certificates in /etc/ssl/certs...</div><div class="line">173 added, 0 removed; done.</div><div class="line">Running hooks in /etc/ca-certificates/update.d...</div><div class="line">done.</div><div class="line"> ---&gt; 46405fbf9585</div><div class="line">Removing intermediate container cb34882ac11d</div><div class="line">Step 4 : RUN gem install sinatra</div><div class="line"> ---&gt; Running in 841ae771b8a6</div><div class="line">Successfully installed rack-1.6.4</div><div class="line">Successfully installed tilt-2.0.5</div><div class="line">Successfully installed rack-protection-1.5.3</div><div class="line">Successfully installed sinatra-1.4.7</div><div class="line">Parsing documentation for rack-1.6.4</div><div class="line">Installing ri documentation for rack-1.6.4</div><div class="line">Parsing documentation for tilt-2.0.5</div><div class="line">Installing ri documentation for tilt-2.0.5</div><div class="line">Parsing documentation for rack-protection-1.5.3</div><div class="line">Installing ri documentation for rack-protection-1.5.3</div><div class="line">Parsing documentation for sinatra-1.4.7</div><div class="line">Installing ri documentation for sinatra-1.4.7</div><div class="line">Done installing documentation for rack, tilt, rack-protection, sinatra after 53 seconds</div><div class="line">4 gems installed</div><div class="line"> ---&gt; 2286ff282669</div><div class="line">Removing intermediate container 841ae771b8a6</div><div class="line">Successfully built 2286ff282669</div><div class="line">SECURITY WARNING: You are building a Docker image from Windows against a non-Windows Docker host. All files and directories added to build context will have &apos;-rwxr-xr-x&apos; permissions. It is recommended to double check and reset permissions for sensitive files and directories.</div></pre></td></tr></table></figure>
<p>You&#x2019;ve specified our <code>docker build</code> command and used the <code>-t</code> flag to identify our new image as belonging to the user <code>chihkang</code>, the repository name sinatra and given it the tag b1.</p>
<p>You&#x2019;ve also specified the location of our <code>Dockerfile</code> using the . to indicate a <code>Dockerfile</code> in the current directory.</p>
<blockquote>
<p><strong>Note: You can also specify a path to a Dockerfile.</strong></p>
</blockquote>
<p>Now you can see the build process at work. The first thing Docker does is upload the build context: basically the contents of the directory you&#x2019;re building in. This is done because the Docker daemon does the actual build of the image and it needs the local context to do it.</p>
<p>Next you can see each instruction in the <code>Dockerfile</code> being executed step-by-step. You can see that each step creates a new container, runs the instruction inside that container and then commits that change - just like the <code>docker commit</code> work flow you saw earlier. When all the instructions have executed you&#x2019;re left with the <code>841ae771b8a6</code> image (also helpfuly tagged as <code>chihkang/sinatra:b1</code>) and all intermediate containers will get removed to clean things up.</p>
<blockquote>
<p><strong>Note: An image can&#x2019;t have more than 127 layers regardless of the storage driver. This limitation is set globally to encourage optimization of the overall size of images.</strong></p>
</blockquote>
<p>You can then create a container from our new image.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt;  docker run -i -t chihkang/sinatra:b1</div><div class="line">root@44ddf6a95269:/#</div></pre></td></tr></table></figure>
<blockquote>
<p>Note: This is just a brief introduction to creating images. We&#x2019;ve skipped a whole bunch of other instructions that you can use. We&#x2019;ll see more of those instructions in later sections of the Guide or you can refer to the Dockerfile reference for a detailed description and examples of every instruction. To help you write a clear, readable, maintainable Dockerfile, we&#x2019;ve also written a <code>Dockerfile</code> <a href="https://docs.docker.com/engine/userguide/eng-image/dockerfile_best-practices/" target="_blank" rel="external">Best Practices</a> guide.</p>
</blockquote>
<h3 id="Setting-tags-on-an-image"><a href="#Setting-tags-on-an-image" class="headerlink" title="Setting tags on an image"></a>Setting tags on an image</h3><p>You can also add a tag to an existing image after you commit or build it. We can do this using the <code>docker tag</code> command. Now, add a new tag to your <code>chihkang/sinatra</code> image.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ docker tag 2286ff282669 chihkang/sinatra:devel</div></pre></td></tr></table></figure>
<p>The <code>docker tag</code> command takes the ID of the image, here <code>2286ff282669</code>, and our user name, the repository name and the new tag.</p>
<p>Now, see your new tag using the <code>docker images</code> command.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ docker images</div><div class="line">REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE</div><div class="line">chihkang/sinatra            b1                  2286ff282669        About an hour ago   210.1 MB</div><div class="line">chihkang/sinatra            devel               2286ff282669        About an hour ago   210.1 MB</div><div class="line">chihkang/sinatra            v2                  7bf415004e58        47 hours ago        641.6 MB</div></pre></td></tr></table></figure>
<h3 id="Image-Digests"><a href="#Image-Digests" class="headerlink" title="Image Digests"></a>Image Digests</h3><p>Images that use the v2 or later format have a content-addressable identifier called a <code>digest</code>. As long as the input used to generate the image is unchanged, the digest value is predictable. To list image digest values, use the <code>--digests</code> flag:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ docker images  --no-trunc | head</div><div class="line">REPOSITORY                  TAG                 IMAGE ID                                                                  CREATED             SIZE</div><div class="line">chihkang/sinatra            b1                  sha256:2286ff2826696be4ce24be0f9798518bebb26786ba792d1684adc63be2cb2bf5   About an hour ago   210.1 MB</div><div class="line">chihkang/sinatra            devel               sha256:2286ff2826696be4ce24be0f9798518bebb26786ba792d1684adc63be2cb2bf5   About an hour ago   210.1 MB</div><div class="line">chihkang/sinatra            v2                  sha256:7bf415004e58ef1b4ab0f2bc258cf1142b6fcac042cd62ab39e5d48174477756   2 days ago          641.6 MB</div></pre></td></tr></table></figure>
<p>When pushing or pulling to a 2.0 registry, the <code>push</code> or <code>pull</code> command output includes the image digest. You can <code>pull</code> using a digest value.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PS C:\Users\Lin&gt; docker pull chihkang/sinatra@sha256:2286ff2826696be4ce24be0f9798518bebb26786ba792d1684adc63be2cb2bf5</div></pre></td></tr></table></figure>
<p>You can also reference by digest in <code>create</code>, <code>run</code>, and <code>rmi</code> commands, as well as the <code>FROM</code> image reference in a Dockerfile.</p>
<h3 id="Remove-an-image-from-the-host"><a href="#Remove-an-image-from-the-host" class="headerlink" title="Remove an image from the host"></a>Remove an image from the host</h3><p>You can also remove images on your Docker host in a way <a href="https://docs.docker.com/engine/tutorials/usingdocker/" target="_blank" rel="external">similar to containers</a> using the <code>docker rmi</code> command.</p>
<p>Delete the <code>training/sinatra</code> image as you don&#x2019;t need it anymore.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ docker rmi -f training/sinatra</div><div class="line">Untagged: training/sinatra:latest</div><div class="line">Untagged: training/sinatra@sha256:03fc0cd265cbc28723e4efd446f9f2f37b4790cf9cc12f1b9203c79fb86b6772</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>Note: To remove an image from the host, please make sure that there are no containers actively based on it.</strong></p>
</blockquote>
</div></article></div></section><footer><div class="paginator"><a href="/2016/08/04/Docker/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'chihkang';
var disqus_identifier = '2016/08/18/build-your-own-images/';
var disqus_title = 'build your own images';
var disqus_url = 'https://chihkang.github.io/2016/08/18/build-your-own-images/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//chihkang.disqus.com/count.js" async></script><div class="copyright"><p>Powered by Hexo and Theme by <a href="https://github.com/pinggod/hexo-theme-apollo">apollo</a> © 2015 - 2016 <a href="https://chihkang.github.io">ChihKang Lin</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>